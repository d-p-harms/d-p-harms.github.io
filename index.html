<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Decision Assessment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        #container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        #game-area {
            position: relative;
            height: 400px;
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #balloon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 150"><path d="M50,10 C20,10 10,40 10,70 C10,100 30,130 50,130 C70,130 90,100 90,70 C90,40 80,10 50,10" fill="%230080ff" stroke="black" stroke-width="2"/><path d="M45,130 L55,130 L55,145 L45,145 Z" fill="%23daa520" stroke="black" stroke-width="1"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            position: relative;
            transition: all 0.1s ease-in-out;
        }
        #pop-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="20" y="60" font-family="Arial" font-size="30" fill="red">POP!</text><path d="M10,10 L90,90 M90,10 L10,90" stroke="red" stroke-width="4"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            display: none;
        }
        #message {
            font-size: 1.2em;
            margin: 10px 0;
            min-height: 4em;
        }
        #instructions {
            margin: 15px 0;
            font-size: 0.9em;
            color: #555;
        }
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #45a049;
        }
        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #pump-button {
            background-color: #2196F3;
        }
        #pump-button:hover {
            background-color: #0b7dda;
        }
        #cashout-button {
            background-color: #ff9800;
        }
        #cashout-button:hover {
            background-color: #e68a00;
        }
        #next-button, #start-button, #show-results-button {
            background-color: #4CAF50;
        }
        #progress-bar {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
        #progress {
            width: 0;
            height: 20px;
            background-color: #4CAF50;
            border-radius: 5px;
            text-align: center;
            line-height: 20px;
            color: white;
        }
        /* Risk meter styles */
        #risk-meter-container {
            width: 100%;
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #risk-meter-label {
            font-weight: bold;
            margin-bottom: 5px;
            width: 100%;
            text-align: center;
        }
        #risk-meter {
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, #4CAF50 37.5%, #FFEB3B 37.5%, #FFEB3B 75%, #F44336 75%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        #risk-pointer {
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 20px;
            background-color: black;
            transition: left 0.3s;
        }
        .screen {
            display: none;
        }
        #info-form, #career-form {
            text-align: left;
            margin: 20px 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .radio-group {
            display: flex;
            flex-direction: column;
        }
        .radio-option {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .radio-option input {
            width: auto;
            margin-right: 10px;
        }
        #results-container {
            text-align: left;
            margin: 20px 0;
        }
        #results-summary {
            font-weight: bold;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .result-highlight {
            font-size: 1.2em;
            color: #2196F3;
        }
        #status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .error {
            background-color: #f2dede;
            color: #a94442;
        }
        /* Career aspirations form styling */
        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        .likert-option {
            text-align: center;
            width: 18%;
        }
        .likert-option input {
            margin: 0 auto 5px auto;
        }
        .likert-option label {
            font-size: 12px;
        }
        .likert-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        .likert-label {
            text-align: center;
            width: 18%;
            font-size: 12px;
        }
        .keyboard-active {
            transform: scale(0.95);
            box-shadow: 0 0 0 3px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>Risk & Career Assessment</h1>
        
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen" style="display: block;">
            <p>Welcome to our interactive assessment of decision-making preferences.</p>
            <p>This assessment consists of two parts:</p>
            <ol>
                <li>An interactive decision-making game</li>
                <li>A brief questionnaire about your professional goals</li>
            </ol>
            <p>All responses will be kept confidential and used for research purposes only.</p>
            
            <div id="info-form">
                <h3>Participant Information:</h3>
                <div class="form-group">
                    <label for="participant-id">Participant ID:</label>
                    <input type="text" id="participant-id" required>
                </div>
                <div class="form-group">
                    <label for="age">Age:</label>
                    <input type="number" id="age" min="18" max="120" required>
                </div>
                <div class="form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender" required>
                        <option value="">Please select</option>
                        <option value="female">Female</option>
                        <option value="male">Male</option>
                        <option value="other">Other</option>
                        <option value="prefer not to say">Prefer not to say</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="education-attained">Highest Education Level Attained/Enrolled:</label>
                    <select id="education-attained" required>
                        <option value="">Please select</option>
                        <option value="high_school">High School/GED</option>
                        <option value="associates">Associate's Degree</option>
                        <option value="bachelors">Bachelor's Degree</option>
                        <option value="masters">Master's Degree</option>
                        <option value="doctorate">Doctorate/PhD</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="education-desired">Highest Education Level Desired:</label>
                    <select id="education-desired" required>
                        <option value="">Please select</option>
                        <option value="high_school">High School/GED</option>
                        <option value="associates">Associate's Degree</option>
                        <option value="bachelors">Bachelor's Degree</option>
                        <option value="masters">Master's Degree</option>
                        <option value="doctorate">Doctorate/PhD</option>
                        <option value="satisfied">Satisfied with current level</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            
            <button id="start-button" class="button">Begin Assessment</button>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <h2>Part 1: Balloon Analogue Risk Task</h2>
            <p>In this task, you will see a balloon that you can inflate by clicking the "Pump" button. Each pump earns you points, but if you pump too much, the balloon will pop and you'll lose all points for that balloon. You can choose to "Collect Points" at any time before the balloon pops.</p>
            
            <div id="progress-bar">
                <div id="progress">0%</div>
            </div>
            
            <!-- Risk Meter -->
            <div id="risk-meter-container">
                <div id="risk-meter-label">
                    <span>Balloon Pop Risk</span>
                </div>
                <div id="risk-meter">
                    <div id="risk-pointer"></div>
                </div>
            </div>
            
            <div id="game-area">
                <div id="balloon"></div>
                <div id="pop-image"></div>
            </div>
            
            <div id="message">Trial 1 of 10</div>
            <div id="points-message">Points for this balloon: 0</div>
            <div id="total-points-display" style="font-size: 1.2em; margin: 10px 0; font-weight: bold; color: #2196F3;">Total points: 0</div>
            <div id="instructions">Press "Pump" to inflate the balloon or "Collect Points" to bank your current points</div>
            
            <div>
                <button id="pump-button" class="button">Pump</button>
                <button id="cashout-button" class="button">Collect Points</button>
            </div>
        </div>
        
        <!-- Career Aspirations Screen -->
        <div id="career-screen" class="screen">
            <h2>Part 2: Career Aspirations Questionnaire</h2>
            <p>Please answer the following questions about your career goals and preferences.</p>
            
            <div id="career-form">
                <!-- Current Career Status -->
                <div class="form-group">
                    <label for="current-position">Current Career Position/Status:</label>
                    <select id="current-position" required>
                        <option value="">Please select</option>
                        <option value="student">Student</option>
                        <option value="entry_level">Entry-level position</option>
                        <option value="mid_level">Mid-level position</option>
                        <option value="senior_level">Senior-level position</option>
                        <option value="manager">Manager/Supervisor</option>
                        <option value="executive">Executive/Director</option>
                        <option value="owner">Business Owner/Entrepreneur</option>
                        <option value="unemployed">Currently unemployed</option>
                        <option value="retired">Retired</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <!-- Field/Industry -->
                <div class="form-group">
                    <label for="industry">Current or Desired Industry/Field:</label>
                    <select id="industry" required>
                        <option value="">Please select</option>
                        <option value="technology">Technology/IT</option>
                        <option value="healthcare">Healthcare/Medical</option>
                        <option value="finance">Finance/Banking</option>
                        <option value="education">Education/Academia</option>
                        <option value="government">Government/Public Service</option>
                        <option value="nonprofit">Non-profit/NGO</option>
                        <option value="retail">Retail/Sales</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="legal">Legal Services</option>
                        <option value="media">Media/Entertainment</option>
                        <option value="hospitality">Hospitality/Tourism</option>
                        <option value="arts">Arts/Creative Fields</option>
                        <option value="construction">Construction/Engineering</option>
                        <option value="agriculture">Agriculture/Farming</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <!-- Career Goals -->
                <div class="form-group">
                    <label for="career-goals">What are your primary career goals for the next 5-10 years? (Optional)</label>
                    <textarea id="career-goals"></textarea>
                </div>
                
                <!-- Financial Status Question -->
                <div class="form-group">
                    <label>How would you describe your current financial situation?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="financial-struggling" name="financial-status" value="struggling" required>
                            <label for="financial-struggling">Struggling to meet basic needs</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="financial-tight" name="financial-status" value="tight">
                            <label for="financial-tight">Making ends meet, but it's tight</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="financial-stable" name="financial-status" value="stable">
                            <label for="financial-stable">Financially stable</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="financial-comfortable" name="financial-status" value="comfortable">
                            <label for="financial-comfortable">Financially comfortable</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="financial-very-comfortable" name="financial-status" value="very_comfortable">
                            <label for="financial-very-comfortable">Very financially comfortable</label>
                        </div>
                    </div>
                </div>
                
                <!-- Financial Safety Net Question -->
                <div class="form-group">
                    <label>How would you describe your financial safety net?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="safety-none" name="financial-safety" value="none" required>
                            <label for="safety-none">No savings or family support to fall back on</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="safety-minimal" name="financial-safety" value="minimal">
                            <label for="safety-minimal">Minimal savings, could survive 1-2 months</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="safety-moderate" name="financial-safety" value="moderate">
                            <label for="safety-moderate">Moderate savings or family support if needed</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="safety-strong" name="financial-safety" value="strong">
                            <label for="safety-strong">Strong safety net, could survive 6+ months</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="safety-very-strong" name="financial-safety" value="very_strong">
                            <label for="safety-very-strong">Very strong safety net, minimal financial concerns</label>
                        </div>
                    </div>
                </div>
                
                <!-- Entrepreneurship -->
                <div class="form-group">
                    <label>Would you accept an offer to co-start a business tomorrow if you had to quit your job?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="entrepreneur-yes" name="entrepreneur" value="yes" required>
                            <label for="entrepreneur-yes">Yes, I would</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="entrepreneur-maybe" name="entrepreneur" value="maybe">
                            <label for="entrepreneur-maybe">I would need time to seriously consider it</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="entrepreneur-no" name="entrepreneur" value="no">
                            <label for="entrepreneur-no">No, I would not</label>
                        </div>
                    </div>
                </div>
                
                <!-- Job Stability vs. Opportunity -->
                <div class="form-group">
                    <label>When considering career opportunities, which do you value more?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="stability" name="career-value" value="stability" required>
                            <label for="stability">Job stability and security</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="balanced" name="career-value" value="balanced">
                            <label for="balanced">A balance of stability and opportunity</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="opportunity" name="career-value" value="opportunity">
                            <label for="opportunity">Growth potential and advancement opportunities</label>
                        </div>
                    </div>
                </div>
                
                <!-- Career Risk Items (Likert Scale) -->
                <h3>Career Risk Assessment</h3>
                <p>For each statement, indicate your level of agreement from 1 (Strongly Disagree) to 5 (Strongly Agree).</p>
                
                <!-- Item 1 -->
                <div class="form-group">
                    <label>I am willing to change careers or industries tomorrow for better opportunities.</label>
                    <div class="likert-scale">
                        <div class="likert-option">
                            <input type="radio" id="career-change-1" name="career-change" value="1" required>
                            <label for="career-change-1">1</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="career-change-2" name="career-change" value="2">
                            <label for="career-change-2">2</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="career-change-3" name="career-change" value="3">
                            <label for="career-change-3">3</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="career-change-4" name="career-change" value="4">
                            <label for="career-change-4">4</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="career-change-5" name="career-change" value="5">
                            <label for="career-change-5">5</label>
                        </div>
                    </div>
                    <div class="likert-labels">
                        <div class="likert-label">Strongly Disagree</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Neutral</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Strongly Agree</div>
                    </div>
                </div>
                
                <!-- Item 2 -->
                <div class="form-group">
                    <label>I would take a pay cut tomorrow for a job that offers better long-term potential.</label>
                    <div class="likert-scale">
                        <div class="likert-option">
                            <input type="radio" id="pay-cut-1" name="pay-cut" value="1" required>
                            <label for="pay-cut-1">1</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="pay-cut-2" name="pay-cut" value="2">
                            <label for="pay-cut-2">2</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="pay-cut-3" name="pay-cut" value="3">
                            <label for="pay-cut-3">3</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="pay-cut-4" name="pay-cut" value="4">
                            <label for="pay-cut-4">4</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="pay-cut-5" name="pay-cut" value="5">
                            <label for="pay-cut-5">5</label>
                        </div>
                    </div>
                    <div class="likert-labels">
                        <div class="likert-label">Strongly Disagree</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Neutral</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Strongly Agree</div>
                    </div>
                </div>
                
                <!-- Item 3 -->
                <div class="form-group">
                    <label>I prefer jobs with variable compensation (e.g., commission, bonuses) over fixed salaries.</label>
                    <div class="likert-scale">
                        <div class="likert-option">
                            <input type="radio" id="variable-comp-1" name="variable-comp" value="1" required>
                            <label for="variable-comp-1">1</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="variable-comp-2" name="variable-comp" value="2">
                            <label for="variable-comp-2">2</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="variable-comp-3" name="variable-comp" value="3">
                            <label for="variable-comp-3">3</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="variable-comp-4" name="variable-comp" value="4">
                            <label for="variable-comp-4">4</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="variable-comp-5" name="variable-comp" value="5">
                            <label for="variable-comp-5">5</label>
                        </div>
                    </div>
                    <div class="likert-labels">
                        <div class="likert-label">Strongly Disagree</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Neutral</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Strongly Agree</div>
                    </div>
                </div>
                
                <!-- Item 4 -->
                <div class="form-group">
                    <label>I would relocate to a new city or country tomorrow for the right career opportunity.</label>
                    <div class="likert-scale">
                        <div class="likert-option">
                            <input type="radio" id="relocate-1" name="relocate" value="1" required>
                            <label for="relocate-1">1</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="relocate-2" name="relocate" value="2">
                            <label for="relocate-2">2</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="relocate-3" name="relocate" value="3">
                            <label for="relocate-3">3</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="relocate-4" name="relocate" value="4">
                            <label for="relocate-4">4</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="relocate-5" name="relocate" value="5">
                            <label for="relocate-5">5</label>
                        </div>
                    </div>
                    <div class="likert-labels">
                        <div class="likert-label">Strongly Disagree</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Neutral</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Strongly Agree</div>
                    </div>
                </div>
                
                <!-- Item 5 -->
                <div class="form-group">
                    <label>I regularly seek out new skills and qualifications even when not required for my current job.</label>
                    <div class="likert-scale">
                        <div class="likert-option">
                            <input type="radio" id="new-skills-1" name="new-skills" value="1" required>
                            <label for="new-skills-1">1</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="new-skills-2" name="new-skills" value="2">
                            <label for="new-skills-2">2</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="new-skills-3" name="new-skills" value="3">
                            <label for="new-skills-3">3</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="new-skills-4" name="new-skills" value="4">
                            <label for="new-skills-4">4</label>
                        </div>
                        <div class="likert-option">
                            <input type="radio" id="new-skills-5" name="new-skills" value="5">
                            <label for="new-skills-5">5</label>
                        </div>
                    </div>
                    <div class="likert-labels">
                        <div class="likert-label">Strongly Disagree</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Neutral</div>
                        <div class="likert-label"></div>
                        <div class="likert-label">Strongly Agree</div>
                    </div>
                </div>
            </div>
            
            <button id="submit-career-button" class="button">Submit and View Results</button>
        </div>
        
        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <h2>Assessment Complete!</h2>
            <p>Thank you for participating in our study on risk behavior and career aspirations.</p>
            
            <div id="results-container">
                <h3>Risk Assessment Results:</h3>
                <div id="results-summary">
                    <p>Your risk aversion score: <span id="risk-score" class="result-highlight">--</span> (0-100)</p>
                    <p>Higher scores indicate more risk-averse behavior.</p>
                </div>
                
                <h3>BART Trial Results:</h3>
                <table id="results-table">
                    <thead>
                        <tr>
                            <th>Trial</th>
                            <th>Pumps</th>
                            <th>Outcome</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Results will be inserted here -->
                    </tbody>
                </table>
                
                <h3>Risk Metrics:</h3>
                <table id="metrics-table">
                    <tbody>
                        <tr>
                            <td>Average pumps (all trials):</td>
                            <td id="avg-pumps-all">--</td>
                        </tr>
                        <tr>
                            <td>Average pumps (unexploded balloons):</td>
                            <td id="avg-pumps-unexploded">--</td>
                        </tr>
                        <tr>
                            <td>Number of explosions:</td>
                            <td id="num-explosions">--</td>
                        </tr>
                        <tr>
                            <td>Proportion of balloons exploded:</td>
                            <td id="prop-explosions">--</td>
                        </tr>
                        <tr>
                            <td>Total points earned:</td>
                            <td id="total-points-earned">--</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>Career Risk Profile:</h3>
                <p id="career-risk-score">Your career risk-taking score: <span class="result-highlight">--</span> (out of 30)</p>
                <p id="risk-correlation">Correlation between BART performance and career risk profile: <span class="result-highlight">--</span></p>
                
                <p id="assessment-interpretation">
                    <!-- Interpretation will be inserted here -->
                </p>
            </div>
            
            <div id="status-message"></div>
            <button id="restart-button" class="button">Start New Session</button>
        </div>
    </div>
    <script>
    // BART Task Configuration
    const MAX_PUMPS = 30;  // Maximum possible pumps per balloon
    const NUM_TRIALS = 10;   // Total number of balloons
    const POP_PROBABILITIES = [];  // Will be calculated on initialization
    const SAFE_ZONE_PUMPS = 5;  // First 5 pumps are 100% safe
    
    // Game state
    let totalPoints = 0;
    let currentTrial = 0;
    let currentPumps = 0;
    let pumpsHistory = [];
    let popHistory = [];
    let gameActive = false;
    let participantInfo = {};
    let careerResponses = {};
    
    // DOM elements
    const welcomeScreen = document.getElementById('welcome-screen');
    const gameScreen = document.getElementById('game-screen');
    const careerScreen = document.getElementById('career-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startButton = document.getElementById('start-button');
    const pumpButton = document.getElementById('pump-button');
    const cashoutButton = document.getElementById('cashout-button');
    const submitCareerButton = document.getElementById('submit-career-button');
    const restartButton = document.getElementById('restart-button');
    const balloon = document.getElementById('balloon');
    const popImage = document.getElementById('pop-image');
    const message = document.getElementById('message');
    const pointsMessage = document.getElementById('points-message');
    const totalPointsDisplay = document.getElementById('total-points-display');
    const progress = document.getElementById('progress');
    const statusMessage = document.getElementById('status-message');
    const riskPointer = document.getElementById('risk-pointer');
    
    // Calculate pop probabilities for each pump - with complex probability distribution
    function initializePopProbabilities() {
        // First 5 pumps have zero probability (safe zone)
        for (let i = 1; i <= SAFE_ZONE_PUMPS; i++) {
            POP_PROBABILITIES[i] = 0; // 0% chance (safe zone)
        }
        
        // Pumps 6-10 have extremely low probability
        for (let i = SAFE_ZONE_PUMPS + 1; i <= 10; i++) {
            POP_PROBABILITIES[i] = 0.01; // Fixed 1% chance
        }
        
        // Pumps 11-15 have gradually increasing but still low probability
        for (let i = 11; i <= 15; i++) {
            // Gradually increase from 1% to 5%
            POP_PROBABILITIES[i] = 0.01 + (i - 10) * 0.008;
        }
        
        // Pumps 16-20 have moderate probability
        for (let i = 16; i <= 20; i++) {
            // Gradually increase from 5% to 15%
            POP_PROBABILITIES[i] = 0.05 + (i - 15) * 0.02;
        }
        
        // Pumps 21-30 have higher probability
        for (let i = 21; i <= MAX_PUMPS; i++) {
            // Gradually increase from 15% to 60% at the maximum
            POP_PROBABILITIES[i] = 0.15 + (i - 20) * 0.045;
        }
    }
    
    // Update the risk meter based on current pump count
    function updateRiskMeter() {
        // Calculate position for the risk pointer based on pump count
        // Scale to make it more visible - map from 0-MAX_PUMPS to 0-100%
        let pointerPosition;
        
        if (currentPumps <= 10) {
            // First 10 pumps - scale position from 0% to 37.5% (green zone)
            pointerPosition = (currentPumps / 10) * 37.5;
        } else if (currentPumps <= 20) {
            // Pumps 11-20 - scale position from 37.5% to 75% (yellow zone)
            pointerPosition = 37.5 + ((currentPumps - 10) / 10) * 37.5;
        } else {
            // Pumps 21+ - scale position from 75% to 100% (red zone)
            // Cap at 98% to keep the pointer visible
            const remaining = Math.min((currentPumps - 20) / (MAX_PUMPS - 20), 0.98);
            pointerPosition = 75 + (remaining * 25);
        }
        
        // Update the risk pointer position
        riskPointer.style.left = pointerPosition + '%';
    }
    
    // Google Sheets Script URL - REPLACE THIS WITH YOUR SCRIPT URL
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxyJMxpRPLv0C1YM4liLZFgcJcoySz_C0XeNp2xLzanePTubN7HA1gqLaJg488MaHn7/exec';
     
    // Generate a unique ID
    function generateUniqueID() {
        return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
    
    // Check if user already has an ID stored
    function checkForExistingUser() {
        let userID = localStorage.getItem('risk_assessment_user_id');
        let lastSubmissionDate = localStorage.getItem('risk_assessment_last_submission');
        
        if (!userID) {
            // First time visitor - generate and store a new ID
            userID = generateUniqueID();
            localStorage.setItem('risk_assessment_user_id', userID);
            
            // Pre-fill the participant ID field
            const participantIdField = document.getElementById('participant-id');
            if (participantIdField) {
                participantIdField.value = userID;
                participantIdField.readOnly = true;
            } else {
                console.error("Participant ID field not found in the DOM");
            }
        } else {
            // Returning user - use the existing ID
            const participantIdField = document.getElementById('participant-id');
            if (participantIdField) {
                participantIdField.value = userID;
                participantIdField.readOnly = true;
            } else {
                console.error("Participant ID field not found in the DOM");
            }
            
            // Check if they've already submitted data
            if (lastSubmissionDate) {
                const lastSubmission = new Date(lastSubmissionDate);
                const currentDate = new Date();
                const daysSinceSubmission = Math.floor((currentDate - lastSubmission) / (1000 * 60 * 60 * 24));
                
                // Show a message if they've already submitted recently
                if (daysSinceSubmission < 7) {
                    const warningMessage = document.createElement('div');
                    warningMessage.style.backgroundColor = '#fff3cd';
                    warningMessage.style.color = '#856404';
                    warningMessage.style.padding = '10px';
                    warningMessage.style.borderRadius = '5px';
                    warningMessage.style.marginBottom = '15px';
                    warningMessage.innerHTML = `<strong>Notice:</strong> It appears you've already completed this assessment within the past week (${daysSinceSubmission} days ago). Multiple submissions from the same participant may affect our research data. Please proceed only if instructed to do so by the researcher.`;
                    
                    const infoForm = document.getElementById('info-form');
                    if (infoForm && infoForm.parentNode) {
                        infoForm.parentNode.insertBefore(warningMessage, infoForm);
                    }
                }
            }
        }
        
        // Log the current user ID for debugging
        console.log("Current user ID:", userID);
        return userID;
    }
